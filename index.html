<!DOCTYPE html>

<meta charset="utf-8">
<html>
  <head>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="js/data_polyfill.js"></script>
    <script src="js/d3.v5.js"></script>
    <script src="js/d3.layout.cloud.js"></script>
    <script src="js/turf.min.js"></script>
    <script src="js/EventData.js"></script>
    <script src="js/Cloud.js"></script>
    <script src="js/USMap.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/jquery-3.3.1.slim.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row" style="height: 600px">
        <div class="col-4">
            <div class="card w-100 h-100">
              <div class="card-header bg-primary text-white ">Categories:</div>
              <div class="card-body">

              </div>
          </div>
        </div>
        <div id="cloudContainer" class="col-8">
          <h2 class="center">Word Cloud</h2>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-2">
          <h2>UI left</h2>
        </div>
        <div id="mapContainer" class="col-sm-8">
        </div>
        <div  class="col-sm-2">
          <h2 class ="right" >UI right</h2>
        </div>
      </div>
    </div>
    <script>

      var stateList = [
      "ALABAMA", "ALASKA", "ARIZONA", "ARKANSAS",
      "CALIFORNIA", "COLORADO", "CONNECTICUT", "DELAWARE",
      "FLORIDA", "GEORGIA", "HAWAII", "IDAHO",
      "ILLINOIS", "INDIANA", "IOWA", "KANSAS",
      "KENTUCKY", "LOUISIANA", "MAINE", "MARYLAND",
      "MASSACHUSETTS", "MICHIGAN", "MINNESOTA", "MISSISSIPPI",
      "MISSOURI", "MONTANA", "NEBRASKA", "NEVADA",
      "NEW HAMPSHIRE", "NEW JERSEY", "NEW MEXICO", "NEW YORK",
      "NORTH CAROLINA", "NORTH DAKOTA", "OHIO", "OKLAHOMA",
      "OREGON", "PENNSYLVANIA", "RHODE ISLAND", "SOUTH CAROLINA",
      "SOUTH DAKOTA", "TENNESSEE", "TEXAS", "UTAH",
      "VERMONT", "VIRGINIA", "WASHINGTON", "WEST VIRGINIA",
      "WISCONSIN", "WYOMING"
      ];


      e = new EventData("data/StormEvents_2014.csv", "data/us-counties.json");

      eventData = [];
      let map, cloud;

      e.on("data", function(data) {
          states = {}
          counties = []

          map = new USMap(800,600);
          map.data = data[1].features;
          map.draw();
          $("#mapContainer").append(map.svg);

          words = []
          cloud = new Cloud(800, 800);
          $("#cloudContainer").append(cloud.svg);

          eventData = data[0];

      })
      e.init()

      function filterEvents(filter) {
        let heatData = []
        filter = new RegExp(filter);
        for (let i = 0; i < eventData.length; i++) {
          if (stateList.indexOf(eventData[i].STATE) == -1)
            continue;
          if (filter.test(eventData[i].EVENT_TYPE)) {
            let stateFips = eventData[i].STATE_FIPS;
            let czFips = eventData[i].CZ_FIPS;

            if (heatData[stateFips]) {
              if (heatData[stateFips][czFips] == undefined)
                heatData[stateFips][czFips] = 1;
              else
                heatData[stateFips][czFips]++;
            } else {
              heatData[stateFips] = [];
              heatData[stateFips][czFips] = 1;
            }
          }
        }
        map.applyHeatMap(heatData);
      }


    </script>
  </body>
</html>
